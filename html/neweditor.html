<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>选择首页后</title>
<link href="../css/gloable.css" rel="stylesheet" type="text/css"> 
<link href="../css/normal.css" rel="stylesheet" type="text/css"> 
</head>
<style type="text/css">
#editPanel{margin:2px; width:711px; height:500px; resize:none; display:none;}
.topbar .fl2{ float:left; margin-left:7px;}
#textarea, #iframe{width:711px;height:500px;margin:2px;}
/*编辑框样式*/
.ui{position: absolute; top: -99999px; left: -99999px; z-index: 100; text-align: center;}
.zbwin {color: black; border: 1px solid #AAA; background-color: white; width:400px;}
.ui .zcls {position: absolute; top: 5px; right: 10px; width: 20px; height: 20px; overflow: hidden; cursor: pointer; z-index: 5;}
.zbwin .zcls {top: 8px; background: url(http://b.bst.126.net/common/widget/wincls.gif) no-repeat 2px center; text-indent: 50px;}
.zbwin .zcls {text-indent: 50px;}
.ui .ztbr {height: 30px;line-height: 30px;text-align: left;background-color: #5E9FF7;font-size: 14px;font-weight: bold;}
.zbwin .ztbr {height: 35px;line-height: 35px;color: black;background: url(http://b.bst.126.net/common/widget/winbar.gif) repeat-x;}
.ui .zttl {width: 85%;padding-left: 10px;}
.ui .zcnt {padding: 10px;min-height: 30px;_height: 30px;font-size: 12px;background-color: white;}
.zbwin .zfom {width: 370px;margin: 0 auto;font-size: 12px;color: #333;text-align: left;}
.ui .zln {line-height: 24px;margin: 10px 0;}
.ui .ztxt {width: 320px;}
.zbwin select, .zbwin textarea, .zbwin .ztxt {border: 1px solid #7F9DB9;}
.zbwin .ztxt {height: 1.3em;padding-top: 3px;}
.zbwin .zact {margin: 25px 0 10px; text-align:center;}	
.zbwin .zbtnok {font-weight: bold;height: 28px;padding: 0 8px;font-size: 14px;cursor: pointer;}
.zbwin .zbtncc {margin-left: 20px;height: 28px;padding: 0 8px;font-size: 14px;cursor: pointer;}
/*colorpicker*/
#colorpicker{position:absolute; top:30px; left:180px;}
#colorpicker table{border-collapse:collapse;margin:0;padding:0;}
#colorpicker .cell td{height:6px;width:6px;}
.color_result{width:216px;}
.color_view{width:110px;height:25px;}
.color_code{text-align:center;font-weight:700;color:#666;font-size:16px;background:#eee;}
/*文件上传按钮样式*/
.type-file-box{ position:relative;width:260px}
input{ vertical-align:middle; margin:0; padding:0}
.type-file-text{ height:22px; border:1px solid #cdcdcd; width:180px;}
.type-file-button{ background-color:#FFF; border:1px solid #CDCDCD;height:24px; width:70px;}
.type-file-file{ position:absolute; top:0; right:0; height:24px; filter:alpha(opacity:0);opacity: 0;width:260px }
</style>
<script type="text/javascript" src="../js/jquery-1.7.1.min.js"></script>
<script type="text/javascript" src="../js/jquery-ui-1.8.18.custom.min.js"></script>
<body>
		<ul class="clear">
			<li>
				<div class="newright">
					<div class="editbox">
						<div class="topbar">
								<div class="fl">
									<select id="fontName">
									</select>
								</div>
								<div class="fl">
									<select id="fontSize"> 
									</select>
								</div>
								<div class="fl"><img src="images/B.jpg" title="加粗"></div>
								<div class="fl"><img src="images/i.jpg" title="斜体"></div> 
								<div class="fl"><img src="images/U.jpg" title="下划线"></div> 
								<div class="fl"><img src="images/A1.jpg" title="字体颜色"></div> 
								<div class="fl2"><img src="images/SLINE.gif"></div> 
								<div class="fl"><img src="images/pailie1.gif" title="居左"></div> 
								<div class="fl"><img src="images/pailie2.gif" title="居中"></div> 
								<div class="fl"><img src="images/pailie3.gif" title="居右"></div> 
								<div class="fl"><img src="images/pailie4.gif" title="缩进"></div> 
								<div class="fl2"><img src="images/SLINE.gif"></div>
								<div class="fl"><img src="images/pailie5.gif" title="段落化"></div>
								<div class="fl2"><img src="images/SLINE.gif"></div>
								<div class="fl"><img src="images/tupianku.gif" title="插入图片"></div> 
								<div class="fl"><img src="images/move.gif" title="插入视频"></div> 
								<div class="fl"><img src="images/LINK.jpg" title="添加链接"></div> 
								<div class="fr"><img src="images/yulan.gif" title="预览"></div>								
								<div class="fr"><img src="images/SLINE.gif"></div>
								<div class="fl fr"><img src="images/t.gif" title="源代码"></div>
						</div>
						<!--<div class="editct">
							
						</div>-->
						<textarea id="textarea"></textarea>
					</div>
				</div>
			</li>
		</ul>


<script type="text/javascript">
/*绘制链接输入框*/
var popLink = (function() {
	var ele = $('<div class="ui zbwin ui-link nbwinautoheight" style="display: none; "></div>');
	var linkHtml = '<div class="nbwinwrap">\n\
						<div class="zcls zflg" title="关闭">\n\
							<div class="txtclose">×</div></div>\n\
							<div class="ztbr noselect zflg zmov">\n\
							<div class="zttl thide zflg">插入链接</div>\n\
						</div>\n\
						<div class="zcnt zflg">\n\
							<div class="">\n\
								<form class="zfom" onsubmit="return false;">\n\
									<div class="zln" style="">\n\
										<label for="id-20997527-0">标题　</label>\n\
										<input class="ztxt" type="text" id="id-20997527-0" name="id-20997527-0">\n\
									</div>\n\
									<div class="zln">\n\
										<label for="id-20997527-1">链接　</label>\n\
										<input class="ztxt" type="text" id="id-20997527-1" name="id-20997527-1" value="http://">\n\
									</div>\n\
									<div class="zact">\n\
										<input class="zbtn zbtnok" type="button" value="确定" name="id-20997527-a">\n\
										<input class="zbtn zbtncc" type="button" value="取消" name="id-20997527-b">\n\
									</div>\n\
								</form>\n\
							</div>\n\
						</div>\n\
					</div>';
	ele.html(linkHtml);
	$("body").append(ele);
 })()
 var popVideo = (function() {
 	var ele = $('<div class="ui zbwin ui-video nbwinautoheight" style="display: none;"></div>');
 	var videoHtml = '<div class="nbwinwrap">\n\
						 <div class="zcls zflg" title="关闭">\n\
							<div class="txtclose">×</div>\n\
						</div>\n\
						<div class="ztbr noselect zflg zmov">\n\
							<div class="zttl thide zflg">插入视频</div>\n\
						</div>\n\
					 	<div class="zcnt zflg">\n\
					 		<div class="">\n\
					 			<form class="zfom" onsubmit="return false;">\n\
					 				<div class="zln zln1">\n\
					 					<label for="id-60884557-0" class="ztag">插入视频</label>\n\
					 					<div style="position:relative; display:inline-block;">\n\
						 					<input type="text" class="type-file-text" />\n\
						 					<input type="submit" name="button" value="浏览..." class="type-file-button"/>\n\
						 					<input name="fileField" type="file" class="type-file-file" class="fileField" size="28" />\n\
					 					</div>\n\
					 					<div class="zact">\n\
											<input class="zbtn zbtnok" type="button" value="确定">\n\
											<input class="zbtn zbtncc" type="button" value="取消">\n\
										</div>\n\
									</form>\n\
								</div>\n\
							</div>\n\
						</div>\n\
					</div>';
	ele.html(videoHtml);
	$("body").append(ele);
 })()
 var popPic = (function() {
 	var ele = $('<div class="ui zbwin ui-pic nbwinautoheight" style="display: none;"></div>');
 	var videoHtml = '<div class="nbwinwrap">\n\
						 <div class="zcls zflg" title="关闭">\n\
							<div class="txtclose">×</div>\n\
						</div>\n\
						<div class="ztbr noselect zflg zmov">\n\
							<div class="zttl thide zflg">插入图片</div>\n\
						</div>\n\
					 	<div class="zcnt zflg">\n\
					 		<div class="">\n\
					 			<form class="zfom" onsubmit="return false;">\n\
					 				<div class="zln zln1">\n\
					 					<label for="id-60884557-0" class="ztag">图片　</label>\n\
					 					<div style="position:relative; display:inline-block;">\n\
					 						<input type="text" class="type-file-text" />\n\
						 					<input type="submit" name="button" value="浏览..." class="type-file-button"/>\n\
						 					<input name="fileField" type="file" class="type-file-file" class="fileField" size="28" />\n\
					 					</div>\n\
					 					<div class="zact">\n\
											<input class="zbtn zbtnok" type="button" value="确定">\n\
											<input class="zbtn zbtncc" type="button" value="取消">\n\
										</div>\n\
									</form>\n\
								</div>\n\
							</div>\n\
						</div>\n\
					</div>';
	ele.html(videoHtml);
	$("body").append(ele);
 })()
 /*colorPicker*/
 var colorPicker = {
 	create: function() {
 		var _hex = ['FF', 'CC', '99', '66', '33', '00'];
		var builder = [];
		//画第一个格子
		var _drawCell = function(builder, red, green, blue) {
		builder.push('<td bgcolor="');
		builder.push('#' + red + green + blue);
		builder.push('"name="');
		builder.push('#' + red + green + blue);
		builder.push('"></td>');
		};
		//画一行,一行六个表格
		var _drawRow = function(builder, red ,blue) {
		builder.push("<tr>");
		for(var i=0; i<6; i++) {
		_drawCell(builder, red, _hex[i], blue);
		}
		builder.push("</tr>")
		};
		//画六行
		var _drawTable = function(builder, blue) {
		builder.push("<table class='cell'>");
		for(var i=0; i<6; i++) {
		_drawRow(builder, _hex[i], blue);
		}
		builder.push("</table>");
		}
		//开始创建
		builder.push('<table><tr>');
		for (var i = 0; i < 3; i++) {
		builder.push('<td>');
		_drawTable(builder, _hex[i]);
		builder.push('</td>');
		}
		builder.push('</tr><tr>');
		for (var i = 3; i < 6; i++) {
		builder.push('<td>');
		_drawTable(builder, _hex[i])
		builder.push('</td>');
		}
		builder.push('</tr></table>');
		return builder.join('');
 	}
 }
/*定义全局变量*/
var bardata = [
		{'title': '字体', 'unselectable': 'on', 'command': 'fontName' },
		{'title': '字号', 'unselectable': 'on', 'command': 'fontSize' },
		{'title': '加粗', 'unselectable': 'on', 'command': 'bold' },
		{'title': '斜体', 'unselectable': 'on', 'command': 'italic' },
		{'title': '下划线', 'unselectable': 'on', 'command': 'underline' },
		{'title': '文字颜色','unselectable': 'on', 'command': 'foreColor' },
		{'title': '左对齐', 'unselectable': 'on', 'command': 'justifyLeft' },
		{'title': '居中对齐', 'unselectable': 'on', 'command': 'justifyCenter' },
		{'title': '右对齐','unselectable': 'on', 'command': 'justifyRight' },
		{'title': '缩进', 'unselectalble': 'on', 'command': 'indent'},
		{'title': '段落化', 'unselectable': 'on', 'command': 'insertParagraph'},
		{'title': '插入图片', 'unselectable': 'on', 'command': 'insertImage'},
		{'title': '插入视频', 'unselectable': 'on', 'command': 'insertVideo'},
		{'title': '插入链接','unselectable': 'on', 'command': 'createLink'},
		{'title': '查看源码','unselectable': 'on', 'command': 'html'}
		];
var fontName = ["宋体","隶书","楷体","幼圆","黑体","雅黑"];
var _fontName = ["SimSun","LiSu","KaiTi_GB2312","YouYuan","SimHei","Microsoft YaHei"];
var fontSize = ["3","4","5","6","7"];
/*创建Editor*/
var Editor = function() {}
 Editor.prototype = {
 	init: function() {
 		_this = this;
 		this.switchMode = true;
 		for(var item in fontName) {
			$("#fontName").append("<option value=" + _fontName[item] + ">" + fontName[item] + "</option>");
		}
		for(var item in fontSize) {
			$("#fontSize").append("<option value=" + fontSize[item] + ">" + fontSize[item] + "</option>");
		}
		$(".fl").each(function() {
			var index = $(".fl").index(this);
			$(this).attr("command", bardata[index].command);
		})
 		this.createiframe();
 		this.bindEvent();
 	},
 	createiframe: function() {
 		var textarea = document.getElementById("textarea");
	    textarea.style.display = "none";
	    this.iframe = document.createElement("iframe");
	    this.iframe.setAttribute("id", "iframe");
	    this.iframe.frameBorder = 0;
	    //这段代码必须放在定义iframedocument之前。因为只有在页面中存在这个dom节点之后才可以
	    textarea.parentNode.insertBefore(this.iframe, textarea);
	    //获取iframe中的document
	    this.iframeDocument = this.iframe.contentDocument || this.iframe.contentWindow.document;
	    //设置模式为可编辑模式
	    this.iframeDocument.designMode = "on"; 
	    //往iframeDocument中输入内容
	    this.iframeDocument.open();
	    var iframecontentHtml = '<html>\n\
	    							<head>\n\
	    								<style type="text/css">\n\
	    								body{ font-family:arial; font-size:13px;background:#FFFFFF; word-wrap:word-break;}\n\
	    								</style>\n\
	    							</head>\n\
	    						</html>';
	    this.iframeDocument.write(iframecontentHtml);
	    this.iframeDocument.close();
 	},
 	bindEvent: function() {
 		$(".fl").bind("click", function() {
			var command = $(this).attr("command");
			_this.executeCommand(command, _this.iframe, _this.iframeDocument);
		});
		this.iframeDocument.addEventListener("click", function() {
			$("#colorpicker").hide();
		}, false);
 	},
 	executeCommand: function(command, iframe, iframeDocument) {
 		switch(command) {
		case "fontName" :
		case "fontSize" :
			_this.changeOption(command,iframeDocument);
			break;
		case "foreColor" :
			_this.initColorPicker(command, iframeDocument);
			break;
		case "createLink" :
			_this.insertLink(command, iframeDocument);
			break;
		case "insertImage" :
			// var value = prompt("请输入图片链接", "http://");
			// iframeDocument.execCommand(command, false, value);
			$(".ui-pic").show();
			$(".ui-pic .zbtnok").click(function() {
				var value = $(".ui-pic #textfield").val();
				iframeDocument.execCommand(command, false, value);
			})
			break;
		case "insertVideo" :
			$(".ui-video").show();
			$(".ui-video .zbtnok").click(function() {
				var value = $(".ui-video #textfield").val();
				var isthtml = "&lt;br/&gt;&lt;" + "!--VIDEO_MARKER_0--" + "&gt;&lt;br/&gt";
				iframeDocument.body.innerHTML += isthtml;
				//iframeDocument.execCommand(command, false, value);
			})
			break;
		case "html" :
			var textarea = document.getElementById("textarea");
			if(_this.switchMode) {
              iframe.style.display = "none";
              textarea.style.display = "block";
              textarea.value = iframeDocument.body.innerHTML;
              textarea.focus();
              _this.switchMode = false;
	        } else {
	              iframe.style.display = "block";
	              textarea.style.display = "none";
	              iframeDocument.body.innerHTML = textarea.value;
	              iframe.contentWindow.focus();
	              _this.switchMode = true;
	          }
	          break;
		default :
			iframeDocument.execCommand(command, false, "");
    		iframe.contentWindow.focus();
    		break;
		}
 	},
 	changeOption: function(command, iframeDocument) {
 		$("select").unbind("change").bind("change", function() {
			var val = $(this).val();
			iframeDocument.execCommand(command, false, val);
		})
 	},
 	initColorPicker: function(command, iframeDocument) {
 		var len = $("#colorpicker").length;
 		if(!len) {
 			var colorPickerHtml = colorPicker.create();
 			var ele = $('<div id="colorpicker"></div>');
 			ele.html(colorPickerHtml);
 			$("body").append(ele);
 		} else {
 			$("#colorpicker").show();
 		}
 		$("#colorpicker .cell td").bind("click", function() {
 			var value = $(this).attr("bgcolor");
 			iframeDocument.execCommand(command, false, value);
 			$("#colorpicker").hide();
 		})
 	},
 	insertLink: function(command, iframeDocument) {
 		$(".ui-link").show();
 		$(".ui-link .zbtnok").click(function() {
 			var title = $(".ui-link .ztxt").eq(0).val();
 			var link = $(".ui-link .ztxt").eq(1).val();
 			var islink = _this.checkLink(link);
 			if(islink) {
	 			if(title == "") {
	 				iframeDocument.execCommand(command, false, link);
	 				_this.clearLinkCnt();	
	 			} else {
	 				var isthtml = "<a href=" + link + ">" + title + "</a>"; 
	 				iframeDocument.execCommand("inserthtml", false, isthtml);
	 				_this.clearLinkCnt();
	 			}
	 		} else {
	 			alert("输入链接错误");
	 		}
 		})	
 	},
 	checkLink: function(url) {
 		if(url.match(/^http:\/\/.+/))
 			return true;
 		else
 			return false;
 	},
 	clearLinkCnt: function() {
 		$(".ui-link").hide();
	 	$(".ui-link .ztxt").eq(0).val("").eq(1).val("http://");
 	}
 }
 $(document).ready(function() {
    $(".fileField").change(function(){
        $(".textfield").val($(".fileField").val());
    });
 	$(".ui .txtclose").click(function() {
 		$(this).parents(".ui").hide();
 	})
 	$(".ui .zbtncc").click(function() {
 		$(this).parents(".ui").hide();
 	})
 	/*设置编辑框可拖动*/
 	$(".ui").draggable();
 	$(window).resize();
	var editor = new Editor();
	editor.init();
 })
$(window).resize(function(){
	$('.ui').css({
	position:'absolute',
	left: ($(window).width() - $('.ui').outerWidth())/2,
	top: ($(window).height() - $('.ui').outerHeight())/2 + $(document).scrollTop()
	});
});
</script>
</body>
</html>
